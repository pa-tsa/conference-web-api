name: continuous-delivery-workflow

on:
  push:
    branches:
      - 'main'

  workflow_dispatch:

jobs:
  gitVersionJob:
    name: GitVersion Workflow
    uses: ./.github/workflows/gitversion-reusable-workflow.yml

  buildApplicationJob:
    name: Build Workflow
    needs: gitVersionJob
    uses: ./.github/workflows/build-reusable-workflow.yml
    with:
      semVer: ${{ needs.gitVersionJob.outputs.semVer }}
    secrets: inherit

  terraformApplyJob:
    name: Terraform Apply Workflow
    needs: gitVersionJob
    uses: ./.github/workflows/terraform-apply-reusable-workflow.yml
    secrets: inherit

  tagRepoJob:
    name: Tag Repo Workflow
    needs: gitVersionJob
    uses: ./.github/workflows/tag-repo-reusable-workflow.yml
    with:
      semVer: ${{ needs.gitVersionJob.outputs.semVer }}
    secrets: inherit